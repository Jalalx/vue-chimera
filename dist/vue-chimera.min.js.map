{"version":3,"file":"vue-chimera.min.js","sources":["../src/utils.js","../src/cache/LocalStorageCache.js","../src/cache/NullCache.js","../node_modules/p-debounce/index.js","../src/Resource.js","../src/NullResource.js","../src/VueChimera.js","../src/mixin.js","../src/index.js","../src/NuxtPlugin.js"],"sourcesContent":["import Axios from 'axios'\n\nexport function isPlainObject (value) {\n  const OBJECT_STRING = '[object Object]'\n  return typeof value === 'object' && Object.prototype.toString(value) === OBJECT_STRING\n}\n\nexport function remove (arr, item) {\n  if (arr.length) {\n    const index = arr.indexOf(item)\n    if (index > -1) {\n      return arr.splice(index, 1)\n    }\n  }\n}\n\nexport function createAxios (config) {\n  if (config instanceof Axios) {\n    return config\n  }\n  if (config && typeof config.$request === 'function') {\n    return config\n  }\n  if (isPlainObject(config)) {\n    return Axios.create(config)\n  }\n  if (typeof config === 'function') {\n    let axios = config()\n    if (axios instanceof Axios) return axios\n  }\n  return Axios\n}\n","export default class LocalStorageCache {\n  constructor (defaultExpiration) {\n    if (typeof window === 'undefined' || !window.localStorage) {\n      throw Error('LocalStorageCache: Local storage is not available.')\n    } else {\n      this.storage = window.localStorage\n    }\n    this.defaultExpiration = defaultExpiration\n  }\n\n  /**\n     *\n     * @param key         Key for the cache\n     * @param value       Value for cache persistence\n     * @param expiration  Expiration time in milliseconds\n     */\n  setItem (key, value, expiration) {\n    this.storage.setItem(key, JSON.stringify({\n      expiration: Date.now() + (expiration || this.defaultExpiration),\n      value\n    }))\n  }\n\n  /**\n     * If Cache exists return the Parsed Value, If Not returns {null}\n     *\n     * @param key\n     */\n  getItem (key) {\n    let item = this.storage.getItem(key)\n    item = JSON.parse(item)\n\n    if (item && item.value && Date.now() <= item.expiration) { return item.value }\n\n    this.removeItem(key)\n    return null\n  }\n\n  removeItem (key) {\n    this.storage.removeItem(key)\n  }\n\n  keys () {\n    return Object.keys(this.storage)\n  }\n\n  all () {\n    return this.keys().reduce((obj, str) => {\n      obj[str] = this.storage.getItem(str)\n      return obj\n    }, {})\n  }\n\n  length () {\n    return this.keys().length\n  }\n\n  clearCache () {\n    this.storage.clear()\n  }\n}\n","export default class NullCache {\n  setItem (key, value, expiration) {}\n\n  getItem (key) {\n    return null\n  }\n\n  removeItem (key) {}\n\n  keys () {\n    return []\n  }\n\n  all () {\n    return {}\n  }\n\n  length () {\n    return 0\n  }\n\n  clearCache () {}\n}\n","'use strict';\nmodule.exports = (fn, wait, opts) => {\n\tif (!Number.isFinite(wait)) {\n\t\tthrow new TypeError('Expected `wait` to be a finite number');\n\t}\n\n\topts = opts || {};\n\n\tlet leadingVal;\n\tlet timer;\n\tlet resolveList = [];\n\n\treturn function () {\n\t\tconst ctx = this;\n\t\tconst args = arguments;\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst runImmediately = opts.leading && !timer;\n\n\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\ttimer = null;\n\n\t\t\t\tconst res = opts.leading ? leadingVal : fn.apply(ctx, args);\n\n\t\t\t\tfor (resolve of resolveList) {\n\t\t\t\t\tresolve(res);\n\t\t\t\t}\n\n\t\t\t\tresolveList = [];\n\t\t\t}, wait);\n\n\t\t\tif (runImmediately) {\n\t\t\t\tleadingVal = fn.apply(ctx, args);\n\t\t\t\tresolve(leadingVal);\n\t\t\t} else {\n\t\t\t\tresolveList.push(resolve);\n\t\t\t}\n\t\t});\n\t};\n};\n","import { isPlainObject, createAxios } from './utils'\nimport LocalStorageCache from './cache/LocalStorageCache'\nimport NullCache from './cache/NullCache'\nimport pDebounce from 'p-debounce'\nimport Axios from 'axios'\nconst { CancelToken } = Axios\n\nexport const EVENT_SUCCESS = 'success'\nexport const EVENT_ERROR = 'error'\nexport const EVENT_CANCEL = 'cancel'\nexport const EVENT_LOADING = 'loading'\n\nexport default class Resource {\n  static from (value, baseOptions = {}) {\n    if (value == null) throw new Error('Cannot create resource from `null`')\n\n    if (value instanceof Resource) { return value }\n\n    if (typeof value === 'string') { return new Resource(value, 'get', baseOptions) }\n\n    if (isPlainObject(value)) {\n      const { url, method, ...options } = value\n      return new Resource(url, method, Object.assign({}, baseOptions, options))\n    }\n  }\n\n  constructor (url, method, options) {\n    options = options || {}\n    method = method ? method.toLowerCase() : 'get'\n    if (method &&\n      ['get', 'post', 'put', 'patch', 'delete'].indexOf(method) === -1) {\n      throw new Error('Bad Method requested: ' + method)\n    }\n\n    this.axios = createAxios(options.axios)\n\n    this.requestConfig = {\n      url: url,\n      method: method ? method.toLowerCase() : 'get',\n      headers: options.headers || {},\n      cancelToken: new CancelToken(c => { this._canceler = c })\n    }\n\n    this.requestConfig[this.requestConfig.method === 'get' ? 'params' : 'data'] = options.params\n\n    this._loading = false\n    this._status = null\n    this._data = null\n    this._headers = null\n    this._error = null\n    this._lastLoaded = null\n    this._eventListeners = {}\n\n    this.ssrPrefetched = false\n\n    this.prefetch = typeof options.prefetch === 'string' ? options.prefetch.toLowerCase() === method : Boolean(options.prefetch)\n    this.ssrPrefetch = options.ssrPrefetch\n    this.cache = this.getCache(options.cache)\n    this.fetchDebounced = pDebounce(this.fetch.bind(this), options.debounce || 80, { leading: true })\n\n    // Set Transformers\n    if (options.transformer) {\n      if (typeof options.transformer === 'function') {\n        this.setTransformer(options.transformer)\n      } else if (typeof options.transformer === 'object') {\n        this.setResponseTransformer(options.transformer.response)\n        this.setErrorTransformer(options.transformer.error)\n      }\n    } else {\n      this.errorTransformer = (err) => err\n      this.responseTransformer = (res) => res\n    }\n\n    // Set interval.\n    if (options.interval) {\n      this.setInterval(options.interval)\n    }\n\n    if (typeof options.on === 'object' && options.on) {\n      for (let key in options.on) {\n        this.on(key, options.on[key])\n      }\n    }\n  }\n\n  setResponseTransformer (transformer) {\n    this.responseTransformer = transformer\n  }\n\n  setErrorTransformer (transformer) {\n    this.errorTransformer = transformer\n  }\n\n  setTransformer (transformer) {\n    this.responseTransformer = transformer\n    this.errorTransformer = transformer\n  }\n\n  setInterval (ms) {\n    if (typeof process !== 'undefined' && process.server) return\n\n    this._interval = ms\n    if (this._interval_id) { clearInterval(this._interval_id) }\n    this._interval_id = setInterval(() => this.reload(true), ms)\n  }\n\n  on (event, handler) {\n    let listeners = this._eventListeners[event] || []\n    listeners.push(handler)\n    this._eventListeners[event] = listeners\n    return this\n  }\n\n  emit (event) {\n    (this._eventListeners[event] || []).forEach(handler => {\n      handler(this)\n    })\n  }\n\n  fetch (force) {\n    return new Promise((resolve, reject) => {\n      let setByResponse = (res) => {\n        this._error = null\n        this._loading = false\n        if (res) {\n          this._status = res.status\n          this._data = this.responseTransformer(res.data)\n          this._headers = res.headers\n          this._lastLoaded = new Date()\n        }\n      }\n\n      if (this.cache && !force) {\n        let cacheValue = this.cache.getItem(this.getCacheKey())\n        if (cacheValue) {\n          setByResponse(cacheValue)\n          resolve(cacheValue)\n          return\n        }\n      }\n\n      this._loading = true\n      this.emit(EVENT_LOADING)\n      this.axios.request(this.requestConfig).then(res => {\n        setByResponse(res)\n        this.setCache(res)\n        this.emit(EVENT_SUCCESS)\n        resolve(res)\n      }).catch(err => {\n        this._data = null\n        this._loading = false\n        const errorResponse = err.response\n        if (errorResponse) {\n          this._status = errorResponse.status\n          this._error = this.errorTransformer(errorResponse.data)\n          this._headers = errorResponse.headers\n        }\n        if (Axios.isCancel(err)) {\n          this.emit(EVENT_CANCEL)\n        } else {\n          this.emit(EVENT_ERROR)\n        }\n\n        reject(err)\n      })\n    })\n  }\n\n  reload (force) {\n    return this.fetchDebounced(force)\n  }\n\n  execute () {\n    return this.fetchDebounced(true)\n  }\n\n  send () {\n    return this.fetchDebounced(true)\n  }\n\n  cancel (unload) {\n    if (unload) this._data = null\n    if (typeof this._canceler === 'function') this._canceler()\n    this.requestConfig.cancelToken = new CancelToken(c => { this._canceler = c })\n  }\n\n  stop () {\n    this.cancel()\n  }\n\n  getCache (cache) {\n    const caches = {\n      'no-cache': () => new NullCache(),\n      'localStorage': () => new LocalStorageCache(this.getConfig().cacheExpiration || 10000)\n    }\n    cache = cache || 'no-cache'\n    return caches[cache] ? caches[cache]() : null\n  }\n\n  getCacheKey () {\n    return (typeof window !== 'undefined' && typeof btoa !== 'undefined'\n      ? window.btoa\n      : x => x)(this.requestConfig.url +\n      this.requestConfig.params +\n      this.requestConfig.data +\n      this.requestConfig.method)\n  }\n\n  setCache (value) {\n    if (this.cache) { this.cache.setItem(this.getCacheKey(), value) }\n  }\n\n  get loading () {\n    return this._loading\n  }\n\n  get status () {\n    return this._status\n  }\n\n  get data () {\n    return this._data\n  }\n\n  get headers () {\n    return this._headers\n  }\n\n  get error () {\n    return this._error\n  }\n\n  get lastLoaded () {\n    return this._lastLoaded\n  }\n}\n","import Resource from './Resource'\n\nexport default class NullResource extends Resource {\n  fetch (force) {\n    return Promise.reject(new Error('Null Resource'))\n  }\n\n  cancel () {}\n\n  get loading () {\n    return false\n  }\n\n  get status () {\n    return 0\n  }\n\n  get data () {\n    return null\n  }\n\n  get error () {\n    return null\n  }\n\n  get lastLoaded () {\n    return null\n  }\n}\n","import Vue from 'vue'\nimport Resource from './Resource'\nimport NullResource from './NullResource'\nimport { remove } from './utils'\n\nexport default class VueChimera {\n  constructor ({ resources, ...options }, context) {\n    this._vm = null\n    this._listeners = []\n    this._context = context\n    this._reactiveResources = {}\n    this.options = options\n\n    resources = Object.assign({}, resources)\n\n    for (let key in resources) {\n      let r = resources[key]\n\n      if (typeof r === 'function') {\n        resources[key] = new NullResource()\n        this._reactiveResources[key] = r.bind(this._context)\n      } else {\n        resources[key] = Resource.from(r, this.options)\n      }\n    }\n\n    this._initVM(resources)\n    this._resources = resources\n  }\n\n  _initVM (data) {\n    this._vm = new Vue({\n      data,\n      computed: {\n        $loading () {\n          for (let key in this.$data) {\n            if (this.$data[key].loading) {\n              return true\n            }\n          }\n          return false\n        }\n      }\n    })\n    Object.defineProperty(data, '$loading', { get: () => this._vm.$loading })\n    Object.defineProperty(data, '$axios', { get: () => Resource.config ? Resource.config.axios : null })\n    Object.defineProperty(data, '$cancelAll', { value: () => this.cancelAll() })\n  }\n\n  watch () {\n    if (!this._watcher) {\n      this._watcher = this._vm.$watch('$data', () => {\n        let i = this._listeners.length\n        while (i--) {\n          let vm = this._listeners[i]\n          if (vm) {\n            vm.$nextTick(() => vm.$forceUpdate())\n          }\n        }\n      }, { deep: true })\n    }\n    return this._watcher\n  }\n\n  subscribe (vm) {\n    this._listeners.push(vm)\n  }\n\n  unsubscribe (vm) {\n    remove(this._listeners, vm)\n  }\n\n  updateReactiveResources () {\n    for (let key in this._reactiveResources) {\n      this.updateReactiveResource(key)\n    }\n  }\n\n  updateReactiveResource (key) {\n    let r = this._resources[key] = Resource.from(this._reactiveResources[key](), this.options)\n    if (r.prefetch) r.reload()\n  }\n\n  cancelAll () {\n    Object.keys(this._resources).forEach(r => {\n      this._resources[r].cancel()\n    })\n  }\n\n  get resources () {\n    return this._resources\n  }\n}\n","import VueChimera from './VueChimera'\nimport { isPlainObject } from './utils'\n\nexport default (config = {}) => ({\n  beforeCreate () {\n    const options = this.$options\n    let _chimera\n\n    // Stop if instance doesn't have chimera or already initialized\n    if (!options.chimera || options._chimera) return\n\n    if (options.chimera instanceof VueChimera) {\n      _chimera = options.chimera\n    } else if (typeof options.chimera === 'function') {\n      // Initialize with function\n      let chimeraOptions = options.chimera.bind(this)()\n      if (chimeraOptions instanceof VueChimera) {\n        _chimera = chimeraOptions\n      } else {\n        _chimera = new VueChimera(Object.assign({}, config, chimeraOptions), this)\n      }\n    } else if (isPlainObject(options.chimera)) {\n      _chimera = new VueChimera(Object.assign({}, config, options.chimera), this)\n    }\n\n    this._chimeraWatcher = _chimera.watch()\n    _chimera.subscribe(this)\n\n    options.computed = options.computed || {}\n    options.watch = options.watch || {}\n    for (let key in _chimera.resources) {\n      options.computed[key] = function () {\n        return this.$chimera[key]\n      }\n    }\n    for (let key in _chimera._reactiveResources) {\n      options.computed['__' + key] = _chimera._reactiveResources[key]\n      options.watch['__' + key] = () => _chimera.updateReactiveResource(key)\n    }\n\n    // Nuxtjs prefetch\n    const NUXT = typeof process !== 'undefined' && process.server && this.$ssrContext\n      ? this.$ssrContext.nuxt\n      : (typeof window !== 'undefined' ? window.__NUXT__ : null)\n    if (_chimera && NUXT && NUXT.chimera) {\n      if (this.$router) {\n        let matched = this.$router.match(this.$router.currentRoute.fullPath);\n        (matched ? matched.matched : []).forEach((m, i) => {\n          let nuxtChimera = NUXT.chimera[i]\n          if (nuxtChimera) {\n            Object.keys(_chimera.resources).forEach(key => {\n              let localResource = _chimera.resources[key]\n              let ssrResource = nuxtChimera[key]\n              if (localResource && ssrResource && ssrResource._data) {\n                ['_data', '_status', '_headers', 'ssrPrefetched', '_lastLoaded'].forEach(key => {\n                  localResource[key] = ssrResource[key]\n                })\n              }\n            })\n          }\n        })\n        if (process.client) {\n          delete NUXT.chimera\n        }\n      }\n    }\n\n    this.$chimera = _chimera.resources\n    this._chimera = _chimera\n  },\n\n  mounted () {\n    if (this._chimera) {\n      this._chimera.updateReactiveResources()\n      for (let r in this._chimera._resources) {\n        let resource = this._chimera._resources[r]\n        if (resource.prefetch && (!resource.ssrPrefetched || resource.ssrPrefetch === 'override')) { resource.reload() }\n      }\n    }\n  },\n\n  beforeDestroy () {\n    if (!this._chimera) {\n      return\n    }\n\n    this._chimera.unsubscribe(this)\n    this._chimera.cancelAll()\n\n    if (this._chimeraWatcher) {\n      this._chimeraWatcher()\n      delete this._chimeraWatcher\n    }\n\n    this._chimera = null\n  }\n})\n","import Vue from 'vue'\nimport mixin from './mixin'\nimport NuxtPlugin from './NuxtPlugin'\n\nVue.config.silent = true\nVue.config.productionTip = false\nVue.config.devtools = false\n\nconst plugin = {\n\n  options: {\n    axios: null,\n    cache: 'no-cache',\n    debounce: 80,\n    prefetch: 'get', // false, true, '%METHOD%',\n    ssrPrefetch: true,\n    ssrPrefetchTimeout: 4000\n  },\n\n  install (Vue, options = {}) {\n    Object.assign(this.options, options)\n    Vue.mixin(mixin(this.options))\n  },\n\n  NuxtPlugin\n\n}\n\n// Auto-install\nlet GlobalVue = null\nif (typeof window !== 'undefined') {\n  GlobalVue = window.Vue\n} else if (typeof global !== 'undefined') {\n  GlobalVue = global.Vue\n}\n\nif (GlobalVue) {\n  GlobalVue.use(plugin, plugin.options)\n}\n\nexport default plugin\n","import Resource from './Resource'\n\nexport default function () {\n  this.options = this.options || {}\n  const baseOptions = this.options\n\n  return function ({ beforeNuxtRender, isDev, $axios }) {\n    if (!beforeNuxtRender) { return }\n\n    const cancelTokens = []\n    async function prefetchAsyncData ({ Components, nuxtState }) {\n      nuxtState.chimera = nuxtState.chimera || {}\n\n      for (let i = 0, len = Components.length; i < len; i++) {\n        let component = Components[i]\n        let chimera = component.options ? component.options.chimera : null\n\n        if (typeof chimera === 'function') {\n          // Append @Nuxtjs/axios to component (maybe needed by constructor)\n          if ($axios && !component.$axios) component.$axios = $axios\n          chimera = chimera.bind(component)()\n        }\n\n        if (!chimera) { continue }\n\n        const nuxtChimera = {}\n        const { resources, ...options } = chimera\n        for (let key in resources) {\n          let resource = resources[key]\n          if (resource && typeof resource !== 'function') {\n            resource = resource && resource._data ? resource : Resource.from(resource, Object.assign({}, baseOptions, options))\n            cancelTokens.push(resource.cancel.bind(resource))\n            if (!resource.prefetch || !resource.ssrPrefetch) continue\n            try {\n              isDev && console.log('  Prefetching: ' + resource.requestConfig.url) // eslint-disable-line no-console\n\n              // resource.axios = Axios\n              let response = await resource.execute()\n              resource._data = response.data\n            } catch (err) {\n              isDev && console.error(err.message) // eslint-disable-line no-console\n            }\n            resource.ssrPrefetched = true\n            resources[key] = nuxtChimera[key] = resource\n          }\n        }\n        if (Object.keys(nuxtChimera).length) {\n          nuxtState.chimera[i] = nuxtChimera\n        }\n      }\n    }\n\n    beforeNuxtRender((...args) => {\n      return new Promise((resolve, reject) => {\n        prefetchAsyncData(...args).then(resolve).catch(reject)\n        setTimeout(reject, baseOptions.ssrPrefetchTimeout, new Error('  SSR Prefetch Timeout.'))\n      }).catch(err => {\n        for (let cancel of cancelTokens) if (typeof cancel === 'function') cancel()\n        isDev && console.error(err.message) // eslint-disable-line no-console\n      })\n    })\n  }\n}\n"],"names":["isPlainObject","value","Object","prototype","toString","LocalStorageCache","constructor","defaultExpiration","window","localStorage","Error","storage","setItem","key","expiration","JSON","stringify","Date","now","this","getItem","item","parse","removeItem","keys","all","reduce","obj","str","length","clearCache","clear","NullCache","fn","wait","opts","Number","isFinite","TypeError","leadingVal","timer","resolveList","ctx","args","arguments","Promise","resolve","runImmediately","leading","clearTimeout","setTimeout","res","apply","push","CancelToken","Axios","EVENT_SUCCESS","EVENT_ERROR","EVENT_CANCEL","EVENT_LOADING","Resource","baseOptions","url","method","options","assign","toLowerCase","indexOf","axios","config","$request","create","createAxios","requestConfig","headers","cancelToken","c","_canceler","params","_loading","_status","_data","_headers","_error","_lastLoaded","_eventListeners","ssrPrefetched","prefetch","Boolean","ssrPrefetch","cache","getCache","fetchDebounced","pDebounce","fetch","bind","debounce","transformer","setTransformer","setResponseTransformer","response","setErrorTransformer","error","errorTransformer","err","responseTransformer","interval","setInterval","on","ms","process","server","_interval","_interval_id","clearInterval","reload","event","handler","listeners","emit","forEach","force","reject","setByResponse","status","data","cacheValue","getCacheKey","request","then","setCache","catch","errorResponse","isCancel","execute","send","cancel","unload","stop","caches","getConfig","cacheExpiration","btoa","x","NullResource","VueChimera","context","resources","_vm","_listeners","_context","_reactiveResources","r","from","_initVM","_resources","Vue","computed","$loading","$data","loading","defineProperty","get","cancelAll","watch","_watcher","$watch","i","vm","$nextTick","$forceUpdate","deep","subscribe","unsubscribe","arr","index","splice","remove","updateReactiveResources","updateReactiveResource","beforeCreate","$options","_chimera","chimera","chimeraOptions","_chimeraWatcher","$chimera","NUXT","$ssrContext","nuxt","__NUXT__","$router","matched","match","currentRoute","fullPath","m","nuxtChimera","localResource","ssrResource","client","mounted","resource","beforeDestroy","silent","productionTip","devtools","plugin","ssrPrefetchTimeout","install","mixin","NuxtPlugin","beforeNuxtRender","isDev","$axios","cancelTokens","Components","nuxtState","len","component","console","log","message","prefetchAsyncData","GlobalVue","global","use"],"mappings":"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"}